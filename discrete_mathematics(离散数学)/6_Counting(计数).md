# 第六章 计数
## 排列和组合

### 排列

所谓排列，就是对集合中的部分元素进行一种安排，这种安排是有顺序的，比如说对于集合S={a,b,c}，在集合S中任意选取两个元素进行排列，就可以得到六种排列：a,b；a,c；b,a；b,c；c,a；c,b。

对于n元素集中r个元素的有序安排称为**r排列**，记作**P(n,r)**

定理：具有n个不同元素的集合的r排列个数为：

$$\begin{align\*}
P(n,r)=n(n-1)(n-2)\cdot\cdot\cdot(n-r+1)
\end{align\*}$$

> 证明是非常容易的，选取这个排列的第一个元素有n种方法，选取第二个元素有n-1种方法，...，选择第r个元素时有n-(r-1)=n-r+1种方法，由乘法法则易得上式。

- 显然 $P(n,r)=\frac{n!}{(n-r)!}$， $P(n,n)=n!$ 
- 另外，只要n是一个非负整数，就有P(n,0)=1。(因为恰好只有一种方法来排列0个元素，也叫做空排列)

> 另外，排列可以看作是从r元集合到n元集合做单射，以r元集合作为定义域，也就是有r个位置，每个位置都去对应n元集合中的一个元素，不难理解，n元集合中任意两个不同的元素如果有位置的话，那么都会对应不同的位置，所以做排列的过程也可以视为做单射的过程。

例：字母ABCDEFGH有多少种排列包含ABC？

解：鉴于ABC必须成组出现，我们可以视集合中有六个对象，分别是ABC，D，E，F，G，H，这6个对象可以按任意次序出现，也就是有6!=720种排列。

关于阶乘的一些补充：

$$\begin{align\*}
n!\approx\sqrt{2\pi n}\cdot(\frac{n}{e})^n(Stirling近似)
\end{align\*}$$

### 组合

相比于排列，组合更加的自然。对集合中的部分元素放在一块，就是组合。它是无顺序的，随意地从集合中选出来放在一起即可。比如说对于集合S={a,b,c}，在集合S中任意选取两个元素进行组合，就可以得到三种组合：a,b；b,c；c,a。

对于n元素集中r个元素的无序选取称为**r组合**，记作**C(n,r)** ，也可以记作 $\binom{n}{r}$ (这也被称作是二项式系数)。

$$\begin{align\*}
n元素集合的r组合数等于\\
C(n,r)=\frac{n!}{r!(n-r)!}
\end{align\*}$$

证明：我们考虑n元素集合的r排列，即P(n,r)，之后我们换一种思路去得到一个r排列：先从n元素集中选出r个元素，即C(n,r)，再对这r个元素进行排列，即P(r,r)，那么我们有：

$$\begin{align\*}
P(n,r)=C(n,r)P(r,r)\\
C(n,r)=\frac{P(n,r)}{P(r,r)}=\frac{\frac{n!}{(n-r)!}}{r!}=\frac{n!}{r!(n-r)!}\\
\end{align\*}$$

- 由公式易得， $C(n,r)=C(n,n-r)$ ，这也不难理解，当你从n元素集合中选取了r个元素，剩下的n-r元素也就唯一确定了。

补充：

```math
如果0\leq p\leq 1,q=1-p,n\rightarrow\infty,那么\\\\
\begin{pmatrix}n\\pn\end{pmatrix}\approx\frac{1}{\sqrt{2\pi}}(p^pq^q)^{-n}(pqn)^{-\frac1 2}(Stirling近似)
```

### 组合证明

组合证明是指不依靠代数技巧而使用计数论述或者基于等式两边的对象集合存在一个双射函数来证明。简单地来讲，所谓依靠代数技巧，其实就是把组合或者排列中的阶乘之类的展开合并，单纯考虑这个式子的计算过程而忽视其代表的意义，而使用计数论述，意思是对于同一种结果，走两种不同的方法，以此来证明两种方法产生的组合式是恒等的，这被称为双计数证明，构造双射函数被称为双射证明

比较难懂，我们举例子来看。

证明 $C(n,r)=C(n,n-r)$ 

双计数证明： $C(n,r)$ 是集合S中含有r个元素的子集A的个数，但S的子集A也确定了不在A中的元素，即 $\overline{A}$ ，r个元素的补集有 $n-r$ 个，所以具有r个元素的子集数目也是 $C(n,r)$ ，故等式成立。

双射证明：从S的子集A到 $\overline{A}$ 的一个函数是从r个元素的子集到n-r个元素的子集的双射函数，该函数的定义域是 $C(n,r)$ 个含有r个元素的子集，该函数的值域是 $C(n,n-r)$ 个含有n-r个元素的子集，（其实这个函数就是指求某个集合的补集），易得这是一个双射函数，故两个集合具有相同的元素个数，等式成立。




## 二项式系数和恒等式

什么是二项式？

所谓**二项式**，不过是两项的和，比如x+y

那么二项式定理，其实就有关于二项式幂的展开式。比如拿 $(x+y)^3$ 来举例， $(x+y)^3$ 其实就是 $(x+y)(x+y)(x+y)$ ,这三个括号中分别各是一个二项式，如果我们要得到 $x^3$ ,那就让每个括号中的二项式都贡献一个 $x$ ,也就是 $\binom{3}{3}$ ,如果我们要得到 $xy^2$ ,我们就从三个二项式中选取两个贡献 $y$ ,剩下的那个自然会贡献 $x$ ,也就是 $\binom{3}{2}$ ，其余的项也同理，这样我们就能得到对应项的系数。

一般地，我们有如下的结论（二项式定理）：

$$\begin{align\*}
(x+y)^n=\sum_{j=0}^n\binom{n}{j}x^{n-j}y^j=\binom{n}{0}x^n+\binom{n}{1}x^{n-1}y+\cdot\cdot\cdot+\binom{n}{n-1}xy^{n-1}+\binom{n}{n}y^n
\end{align\*}$$

- 对于任意的一项 $x^{n-j}y^j$ ,其实就是 $n-j$ 个 $(x+y)$ 贡献了x，而 $j$ 个 $(x+y)$ 贡献了y。
- 取x=1，y=1，则有 $\sum_{j=0}^n\binom{n}{j}=2^n$ 
- 取x=1，y=-1，则有 $\sum_{j=0}^n(-1)^j\binom{n}{j}=0$ 
- 上面两式相加减，可得 $\binom{n}{0}+\binom{n}{2}+\binom{n}{4}+\cdot\cdot\cdot=\binom{n}{1}+\binom{n}{3}+\binom{n}{5}+\cdot\cdot\cdot=2^{n-1}$ 
- 取x=1，y=-1，则有 $\sum_{j=0}^n(p)^j\binom{n}{j}=(p+1)^j$ 

### 组合恒等式

#### 帕斯卡恒等式

$$\begin{align\*}
令n,k皆为正整数并且k\leqslant n,则有:\\
\binom{n+1}{k}=\binom{n}{k-1}+\binom{n}{k}
\end{align\*}$$

证明：等式左边是从n+1个元素中选取k个，等式右边是先选取集合中的一个特定元素（不妨记为a），要么选择a并且再从剩下的n个中选择k-1个，要么不选择a并且再从剩下的n个中选择k个，也就是等式右边，这样就证明了等式成立。

> 这只是帕斯卡恒等式的一个组合证明，实际上我们也可以使用代数推导，就是把它写成阶乘的形式再计算。

由帕斯卡恒等式，我们可以得到下面的三角形：

<p align="center">
<img src="https://github.com/user-attachments/assets/8edf613d-077f-48ba-b48f-a71817476081" width="700" />

> 这个三角形被称为帕斯卡三角，也叫杨辉三角。

注意：

- 帕斯卡恒等式在这个三角形上有很好的体现。
- 二项式定理中的系数在这个三角形上也能被很好地体现。
- 该三角形还可以用于证明其他的组合恒等式

#### 范德蒙德恒等式

$$\begin{align\*}
设m,n,r是非负整数，其中r不超过m或n，则有\\
\binom{n+m}{r}=\sum_{k=0}^r\binom{m}{r-k}\binom{n}{k}
\end{align\*}$$

证明：等式左边是从m+n个元素中选取r个元素，这等价于从m个元素中选取r-k个，再从n个元素中选取k个，k从0取到r，累加在一起，就是等式右边。

- 特别地，我们取m=n，r=n，由 $\binom{n}{r-k}\binom{n}{k}$ ，可得 $\binom{2n}{n}=\sum_{k=0}^r\binom{n}{k}^2$ 

范德蒙德行列式在帕斯卡三角上的反映：

<p align="center">
<img src="https://github.com/user-attachments/assets/9e6f9a7d-526a-46ae-a93c-f6d74d72f5e4" width="500" />

$$\begin{align\*}
\binom{9}{6}=\binom{8}{5}\binom{1}{1}+\binom{8}{6}\binom{1}{0}\\
=\binom{7}{4}\binom{2}{2}+\binom{7}{5}\binom{2}{1}+\binom{7}{6}\binom{2}{0}\\
=\binom{6}{3}\binom{3}{3}+\binom{6}{4}\binom{3}{2}+\binom{6}{5}\binom{3}{1}+\binom{6}{6}\binom{3}{0}=\cdot\cdot\cdot
\end{align\*}$$

#### 其他恒等式

$$\begin{align\*}
设n和r是非负整数，r\leqslant n，那么
\binom{n+1}{m+1}=\sum_{j=r}^n\binom{j}{r}
\end{align\*}$$

证明（说实在的，我并不明白这个证明思路到底是怎么想出来的）：我们考虑长度为n+1的比特串，等式左边是在这个比特串中选出r+1个位置来放1，而其余位置放0，这等价于下面这种计数方式：

   考虑这个比特串中从左往右数的最后一个1的位置，由于前面已经出现过r个1了，故最后一个1的位置可能是r+1，r+2，...，n+1。当最后一个1出现在j+1位的时候，意味着前j位出现过了r个1，即 $\binom{j}{r}$ ，j从r取到n，进行累加就是等式右边。

该恒等式在帕斯卡三角形上的反映：

<p align="center">
<img src="https://github.com/user-attachments/assets/3e89f598-068b-4655-a9e9-299ec3c67e6e" width="500" align=" center" />

$$\begin{align\*}\binom{9}{5}=\binom{8}{4}+\binom{8}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{7}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{6}{4}+\binom{6}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{6}{4}+\binom{5}{4}+\binom{5}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{6}{4}+\binom{5}{4}+\binom{4}{4}
\end{align\*}$$

恒等式 $k\binom{n}{k}=n\binom{n-1}{k-1}$ ：从n个队员中选择k个参加比赛，再从k个参加比赛的队员中选出一个队长，与直接从n个队员中选出一个队长，再从剩下的n-1个队员中选出k-1个参加比赛是等价的。

恒等式 $\binom{n}{r}\binom{r}{k}=\binom{n}{k}\binom{n-k}{r-k}$ ：从n个人当中选出r个参加第一轮面试，再从r个人中选出k个参加第二轮面试，等价于从n个人中选出k个人跳过第一轮面试而直接参加第二轮面试，再从剩下的n-k个人中选出r-k个只能参加第一轮面试而无法参加第二轮面试，两种方法最后都是选出k个人参加第二轮面试。（只不过第二种方法更有暗箱操作一些，k个人直接晋级而剩下的r-k个人沦为炮灰）

恒等式 $\sum_{k=1}^nk\binom{n}{k}=n2^{n-1}$ ：对于一个固定的k，从n个人当中选出k个人组队，从k个人当中选出队长，k可以是1,2,3...,n，对方法数进行累加，与直接从n个人当中选出一个队长，剩下的n-1个人每个人都有两种选择，要么加入队伍，要么不加入队伍是等价的。

### 格点计数

问题基础：给定一张格表，从格表的左下角出发，每次只能走一个单位长度，并且只能选择向上或者向右走，最后的目标是到达指定点(a,b)。如下图所示：

<p align="center">
<img src="https://github.com/user-attachments/assets/82872920-2389-43c5-ab67-74152a82fe29" width="500" align=" center" />

问题1：有多少种可能的路径？

为了到达指定点(a,b)，我们一共需要走a+b步，其中向上总共了走了b步，向右总共走了a步，我们只需要从a+b步中选出a步向右走即可，也就是 $\binom{a+b}{a}$ 。

实际上，格点图可以帮我们理解许多组合恒等式。

理解帕斯卡恒等式：为了达到指定点(a,b)，那么必须要到达点(a-1,b)或者(a,b-1)，那么同理，到达(a-1,b)需要 $\binom{a+b-1}{a-1}$ ，到达(a,b-1)需要 $\binom{a+b-1}{a}$ ，所以有

$$\begin{align\*}
\binom{a+b}{a}=\binom{a+b-1}{a-1}+\binom{a+b-1}{a}
\end{align\*}$$

理解范德蒙德恒等式：我们考虑格点中的一条直线，这条直线位于到达指定点  $(m+n-r,r)$ 的必经之路上，该直线为 $x+y=n(0\leqslant y\leqslant r)$ ，我们要想到达指定点，一定会经过该直线上一点 $(j,n-j)(0\leqslant j\leqslant r)$ ，此时我们一共走了 $n$ 步，可能的路径数为 $\binom{n}{j}$ ，但我们一共需要走 $m+n$ 步，还差 $m$ 步，而之前我们已经向上走过了 $n-j$ 步，还需向上再走 $j$ 步，故可能路径数为 $\binom{m}{r-j}$ 再由乘法原理，进行累加，便能得到：

$$\begin{align\*}
\binom{m+n}{r}=\sum_{j=0}^r\binom{m}{r-j}\binom{n}{j}
\end{align\*}$$

理解 $\binom{n+1}{m+1}=\sum_{j=r}^n\binom{j}{r}$ ：考虑到达指定点 $(n-r,r+1)$ ,我们仍然考虑格点中的一条直线 $y=r$ ,显然若想到达指定点，就必须经过这一条直线，若路径最后一次经过该直线上的点 $(j,r)(0\leqslant j\leqslant n-r)$ ，那么从出发点到这个点共有 $\binom{j+r}{r}$ 种可能路径，而在经过这个点之后，我们不能再立即向右走（否则就不是最后一个交点了），我们只能向上走达到高度 $r+1$ ，那么之后的路就无法继续向上走，而只能一路向右到达指定点。（要注意的是，这里的点 $(j,r)(0\leqslant j\leqslant n-r)$ 是指路径最后一个与直线 $y=r$ 相交的点，因为我们其实完全可以沿着这条直线走一段距离，在那种情况下路径会与这条直线有许多个交点。）

问题二：设指定点为 $(a,b)(a<b)$ ,有多少条路径不会触碰到直线 $y=x$ ?

显然，第一步必须向上走（否则就会来到直线 $y=x$ 下方导致必然触碰到该直线，毕竟指定点在这条直线上方）。

这样，问题转化为了从点 $(0,1)$ 走到指定点，不考虑限制条件，一共走了 $a+b-1$ 步，其中有 $a$ 步是向右走，故有 $\binom{a+b-1}{a}$ 种可能路径。

我们把可能的路径分为两类，一类是不触碰到直线 $y=x$ ，记为集合 $S_1$ ,另一类是触碰到直线 $y=x$ ，记为集合 $S_2$ 。但是要注意的是，这两类可能的路径都是从点 $(0,1)$ 走到指定点，而并不是从点 $(0,0)$ 出发的。我们要求的就是集合 $S_1$ 的势（也就是元素个数）。

我们考虑一类特殊的路径，从点 $(1,0)$ 走到指定点，显然，这类路径必然会与直线 $y=x$ 相交，记为集合 $S_3$ 。我们接下来证明集合 $S_2$ 与集合 $S_3$ 之间存在一个双射：

考虑集合 $S_2$ 中的任意一条路径P，该路径与直线 $y=x$ 相交于点 $(m,m)$ ,我们将从点 $(0,1)$ 走到点 $(m,m)$ 的这段路径沿直线 $y=x$ 对称，恰好能得到一条从点 $(1,0)$ 到指定点 $(a,b)$ 的路径，显然这条路径属于集合 $S_3$ ,当我们考虑集合 $S_3$ 中的任意一条路径F时，也依据相同的原理来做对称，不难看出这其实就是一个从集合 $S_2$ 到集合 $S_3$ 的双射，即两集合具有相同的元素个数。

$$\begin{align\*}
|S_2|=|S_3|=\binom{a+b-1}{a-1}\\
\therefore |S_1|=\binom{a+b-1}{a}-|S_2|=\binom{a+b-1}{a}-\binom{a+b-1}{a-1}\\
=\frac{(a+b-1)!}{a!(b-1)!}-\frac{(a+b-1)!}{(a-1)!b!}=\frac{b}{a+b}\frac{(a+b)!}{a!b!}-\frac{a}{a+b}\frac{(a+b)!}{a!b!}\\
|S_1|=\frac{b-a}{a+b}\frac{(a+b)!}{a!b!}=\frac{b-a}{a+b}\binom{a+b}{a}
\end{align\*}$$

<p align="center">
<img src="https://github.com/user-attachments/assets/41f795ff-e151-4d84-93d7-b5406c5d9db3" width="250" />


