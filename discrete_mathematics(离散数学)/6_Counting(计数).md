# 第六章 计数
## 排列和组合

### 排列

&emsp;&emsp; 所谓排列，就是对集合中的部分元素进行一种安排，这种安排是有顺序的，比如说对于集合S={a,b,c}，在集合S中任意选取两个元素进行排列，就可以得到六种排列：a,b；a,c；b,a；b,c；c,a；c,b。

&emsp;&emsp; 对于n元素集中r个元素的有序安排称为**r排列**，记作**P(n,r)**

&emsp;&emsp; 定理：具有n个不同元素的集合的r排列个数为：

$$\begin{align\*}
P(n,r)=n(n-1)(n-2)\cdot\cdot\cdot(n-r+1)
\end{align\*}$$

> 证明是非常容易的，选取这个排列的第一个元素有n种方法，选取第二个元素有n-1种方法，...，选择第r个元素时有n-(r-1)=n-r+1种方法，由乘法法则易得上式。

- 显然 $P(n,r)=\frac{n!}{(n-r)!}$， $P(n,n)=n!$ 
- 另外，只要n是一个非负整数，就有P(n,0)=1。(因为恰好只有一种方法来排列0个元素，也叫做空排列)

> 另外，排列可以看作是从r元集合到n元集合做单射，以r元集合作为定义域，也就是有r个位置，每个位置都去对应n元集合中的一个元素，不难理解，n元集合中任意两个不同的元素如果有位置的话，那么都会对应不同的位置，所以做排列的过程也可以视为做单射的过程。

&emsp;&emsp; 例：字母ABCDEFGH有多少种排列包含ABC？

&emsp;&emsp; 解：鉴于ABC必须成组出现，我们可以视集合中有六个对象，分别是ABC，D，E，F，G，H，这6个对象可以按任意次序出现，也就是有6!=720种排列。

&emsp;&emsp; 关于阶乘的一些补充：

$$\begin{align\*}
n!\approx\sqrt{2\pi n}\cdot(\frac{n}{e})^n(Stirling近似)
\end{align\*}$$

### 组合

&emsp;&emsp; 相比于排列，组合更加的自然。对**集合中的部分元素放在一块**，就是组合。它是无顺序的，随意地从集合中选出来放在一起即可。比如说对于集合S={a,b,c}，在集合S中任意选取两个元素进行组合，就可以得到三种组合：a,b；b,c；c,a。

&emsp;&emsp; 对于n元素集中r个元素的无序选取称为**r组合**，记作**C(n,r)** ，也可以记作 $\binom{n}{r}$ (这也被称作是**二项式系数**)。

$$\begin{align\*}
n元素集合的r组合数等于\\
C(n,r)=\frac{n!}{r!(n-r)!}
\end{align\*}$$

&emsp;&emsp; 证明：我们考虑n元素集合的r排列，即P(n,r)，之后我们换一种思路去得到一个r排列：先从n元素集中选出r个元素，即C(n,r)，再对这r个元素进行排列，即P(r,r)，那么我们有：

$$\begin{align\*}
P(n,r)=C(n,r)P(r,r)\\
C(n,r)=\frac{P(n,r)}{P(r,r)}=\frac{\frac{n!}{(n-r)!}}{r!}=\frac{n!}{r!(n-r)!}\\
\end{align\*}$$

- 由公式易得， $C(n,r)=C(n,n-r)$ ，这也不难理解，当你从n元素集合中选取了r个元素，剩下的n-r元素也就唯一确定了。



&emsp;&emsp; 补充：

```math
如果0\leq p\leq 1,q=1-p,n\rightarrow\infty,那么\\\\
\begin{pmatrix}n\\pn\end{pmatrix}\approx\frac{1}{\sqrt{2\pi}}(p^pq^q)^{-n}(pqn)^{-\frac1 2}(Stirling近似)
```

### 组合证明

&emsp;&emsp; 组合证明是指不依靠代数技巧而使用计数论述或者基于等式两边的对象集合存在一个双射函数来证明。简单地来讲，所谓依靠代数技巧，其实就是把组合或者排列中的阶乘之类的展开合并，单纯考虑这个式子的计算过程而忽视其代表的意义，而使用计数论述，意思是对于同一种结果，走两种不同的方法，以此来证明两种方法产生的组合式是恒等的，这被称为**双计数证明**，构造双射函数被称为**双射证明**

&emsp;&emsp; 比较难懂，我们举例子来看。

&emsp;&emsp; 证明 $C(n,r)=C(n,n-r)$ 

&emsp;&emsp; 双计数证明： $C(n,r)$ 是集合S中含有r个元素的子集A的个数，但S的子集A也确定了不在A中的元素，即 $\overline{A}$ ，r个元素的子集的补集有 $C(n,n-r)$ 个，所以具有r个元素的子集数目也是 $C(n,n-r)$ ，故等式成立。

&emsp;&emsp; 双射证明：从S的子集A到 $\overline{A}$ 的一个函数是从r个元素的子集到n-r个元素的子集的双射函数，该函数的定义域是 $C(n,r)$ 个含有r个元素的子集，该函数的值域是 $C(n,n-r)$ 个含有n-r个元素的子集，（其实这个函数就是指求某个集合的补集），易得这是一个双射函数，故两个集合具有相同的元素个数，等式成立。




## 二项式系数和恒等式

&emsp;&emsp; 什么是二项式？

&emsp;&emsp; 所谓**二项式**，不过是两项的和，比如x+y

&emsp;&emsp; 那么二项式定理，其实就有关于二项式幂的展开式。比如拿 $(x+y)^3$ 来举例， $(x+y)^3$ 其实就是 $(x+y)(x+y)(x+y)$ ,这三个括号中分别各是一个二项式，如果我们要得到 $x^3$ ,那就让每个括号中的二项式都贡献一个 $x$ ,也就是 $\binom{3}{3}$ ,如果我们要得到 $xy^2$ ,我们就从三个二项式中选取两个贡献 $y$ ,剩下的那个自然会贡献 $x$ ,也就是 $\binom{3}{2}$ ，其余的项也同理，这样我们就能得到对应项的系数。

&emsp;&emsp; 一般地，我们有如下的结论（二项式定理）：

$$\begin{align\*}
(x+y)^n=\sum_{j=0}^n\binom{n}{j}x^{n-j}y^j=\binom{n}{0}x^n+\binom{n}{1}x^{n-1}y+\cdot\cdot\cdot+\binom{n}{n-1}xy^{n-1}+\binom{n}{n}y^n
\end{align\*}$$

- 对于任意的一项 $x^{n-j}y^j$ ,其实就是 $n-j$ 个 $(x+y)$ 贡献了x，而 $j$ 个 $(x+y)$ 贡献了y。
- 取x=1，y=1，则有 $\sum_{j=0}^n\binom{n}{j}=2^n$ 
- 取x=1，y=-1，则有 $\sum_{j=0}^n(-1)^j\binom{n}{j}=0$ 
- 上面两式相加减，可得 $\binom{n}{0}+\binom{n}{2}+\binom{n}{4}+\cdot\cdot\cdot=\binom{n}{1}+\binom{n}{3}+\binom{n}{5}+\cdot\cdot\cdot=2^{n-1}$ 
- 取x=p，y=1，则有 $\sum_{j=0}^n(p)^j\binom{n}{j}=(p+1)^n$ 

### 组合恒等式

#### 帕斯卡恒等式

$$\begin{align\*}
令n,k皆为正整数并且k\leqslant n,则有:\\
\binom{n+1}{k}=\binom{n}{k-1}+\binom{n}{k}
\end{align\*}$$

&emsp;&emsp; 证明：等式左边是从n+1个元素中选取k个，等式右边是先选取集合中的一个特定元素（不妨记为a），要么选择a并且再从剩下的n个中选择k-1个，要么不选择a并且再从剩下的n个中选择k个，也就是等式右边，这样就证明了等式成立。

> 这只是帕斯卡恒等式的一个组合证明，实际上我们也可以使用代数推导，就是把它写成阶乘的形式再计算。

&emsp;&emsp; 由帕斯卡恒等式，我们可以得到下面的三角形：

<p align="center">
<img src="https://github.com/user-attachments/assets/8edf613d-077f-48ba-b48f-a71817476081" width="700" />

> 这个三角形被称为帕斯卡三角，也叫杨辉三角。

&emsp;&emsp; 注意：

- 帕斯卡恒等式在这个三角形上有很好的体现。
- 二项式定理中的系数在这个三角形上也能被很好地体现。
- 该三角形还可以用于证明其他的组合恒等式

#### 范德蒙德恒等式

$$\begin{align\*}
设m,n,r是非负整数，其中r不超过m或n，则有\\
\binom{n+m}{r}=\sum_{k=0}^r\binom{m}{r-k}\binom{n}{k}
\end{align\*}$$

&emsp;&emsp; 证明：等式左边是从m+n个元素中选取r个元素，这等价于从m个元素中选取r-k个，再从n个元素中选取k个，k从0取到r，累加在一起，就是等式右边。

- 特别地，我们取m=n，r=n，由 $\binom{n}{r-k}\binom{n}{k}$ ，可得 $\binom{2n}{n}=\sum_{k=0}^r\binom{n}{k}^2$ 

&emsp;&emsp; 范德蒙德行列式在帕斯卡三角上的反映：

<p align="center">
<img src="https://github.com/user-attachments/assets/9e6f9a7d-526a-46ae-a93c-f6d74d72f5e4" width="500" />

$$\begin{align\*}
\binom{9}{6}=\binom{8}{5}\binom{1}{1}+\binom{8}{6}\binom{1}{0}\\
=\binom{7}{4}\binom{2}{2}+\binom{7}{5}\binom{2}{1}+\binom{7}{6}\binom{2}{0}\\
=\binom{6}{3}\binom{3}{3}+\binom{6}{4}\binom{3}{2}+\binom{6}{5}\binom{3}{1}+\binom{6}{6}\binom{3}{0}=\cdot\cdot\cdot
\end{align\*}$$

#### 其他恒等式

$$\begin{align\*}
设n和r是非负整数，r\leqslant n，那么
\binom{n+1}{r+1}=\sum_{j=r}^n\binom{j}{r}
\end{align\*}$$

&emsp;&emsp; 证明（说实在的，我并不明白这个证明思路到底是怎么想出来的）：我们考虑长度为n+1的比特串，等式左边是在这个比特串中选出r+1个位置来放1，而其余位置放0，这等价于下面这种计数方式：

   考虑这个比特串中从左往右数的最后一个1的位置，由于前面已经出现过r个1了，故最后一个1的位置可能是r+1，r+2，...，n+1。当最后一个1出现在j+1位的时候，意味着前j位出现过了r个1，即 $\binom{j}{r}$ ，j从r取到n，进行累加就是等式右边。

&emsp;&emsp; 该恒等式在帕斯卡三角形上的反映：

<p align="center">
<img src="https://github.com/user-attachments/assets/3e89f598-068b-4655-a9e9-299ec3c67e6e" width="500" align=" center" />

$$\begin{align\*}\binom{9}{5}=\binom{8}{4}+\binom{8}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{7}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{6}{4}+\binom{6}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{6}{4}+\binom{5}{4}+\binom{5}{5}\\
=\binom{8}{4}+\binom{7}{4}+\binom{6}{4}+\binom{5}{4}+\binom{4}{4}
\end{align\*}$$

&emsp;&emsp; 恒等式 $k\binom{n}{k}=n\binom{n-1}{k-1}$ ：从n个队员中选择k个参加比赛，再从k个参加比赛的队员中选出一个队长，与直接从n个队员中选出一个队长，再从剩下的n-1个队员中选出k-1个参加比赛是等价的。

&emsp;&emsp; 恒等式 $\binom{n}{r}\binom{r}{k}=\binom{n}{k}\binom{n-k}{r-k}$ ：从n个人当中选出r个参加第一轮面试，再从r个人中选出k个参加第二轮面试，等价于从n个人中选出k个人跳过第一轮面试而直接参加第二轮面试，再从剩下的n-k个人中选出r-k个只能参加第一轮面试而无法参加第二轮面试，两种方法最后都是选出k个人参加第二轮面试。（只不过第二种方法更有暗箱操作一些，k个人直接晋级而剩下的r-k个人沦为炮灰）

&emsp;&emsp; 恒等式 $\sum_{k=1}^nk\binom{n}{k}=n2^{n-1}$ ：对于一个固定的k，从n个人当中选出k个人组队，从k个人当中选出队长，k可以是1,2,3...,n，对方法数进行累加，与直接从n个人当中选出一个队长，剩下的n-1个人每个人都有两种选择，要么加入队伍，要么不加入队伍是等价的。

## 格点计数

&emsp;&emsp; （格点计数并不是课本章节，但它确实十分形象且有用，故添加在此）

&emsp;&emsp; 问题基础：给定一张格表，从格表的左下角出发，每次只能走一个单位长度，并且只能选择向上或者向右走，最后的目标是到达指定点(a,b)。如下图所示：

<p align="center">
<img src="https://github.com/user-attachments/assets/82872920-2389-43c5-ab67-74152a82fe29" width="500" align=" center" />

&emsp;&emsp; **问题1：** 有多少种可能的路径？

&emsp;&emsp; 为了到达指定点(a,b)，我们一共需要走a+b步，其中向上总共了走了b步，向右总共走了a步，我们只需要从a+b步中选出a步向右走即可，也就是 $\binom{a+b}{a}$ 。

&emsp;&emsp; 实际上，格点图可以帮我们理解许多组合恒等式。

&emsp;&emsp; 理解帕斯卡恒等式：为了达到指定点(a,b)，那么必须要到达点(a-1,b)或者(a,b-1)，那么同理，到达(a-1,b)需要 $\binom{a+b-1}{a-1}$ ，到达(a,b-1)需要 $\binom{a+b-1}{a}$ ，所以有

$$\begin{align\*}
\binom{a+b}{a}=\binom{a+b-1}{a-1}+\binom{a+b-1}{a}
\end{align\*}$$

&emsp;&emsp; 理解范德蒙德恒等式：我们考虑格点中的一条直线，这条直线位于到达指定点  $(m+n-r,r)$ 的必经之路上，该直线为 $x+y=n(0\leqslant y\leqslant r)$ ，我们要想到达指定点，一定会经过该直线上一点 $(j,n-j)(0\leqslant j\leqslant r)$ ，此时我们一共走了 $n$ 步，可能的路径数为 $\binom{n}{j}$ ，但我们一共需要走 $m+n$ 步，还差 $m$ 步，而之前我们已经向上走过了 $n-j$ 步，还需向上再走 $j$ 步，故可能路径数为 $\binom{m}{r-j}$ 再由乘法原理，进行累加，便能得到：

$$\begin{align\*}
\binom{m+n}{r}=\sum_{j=0}^r\binom{m}{r-j}\binom{n}{j}
\end{align\*}$$

&emsp;&emsp; 理解 $\binom{n+1}{m+1}=\sum_{j=r}^n\binom{j}{r}$ ：考虑到达指定点 $(n-r,r+1)$ ,我们仍然考虑格点中的一条直线 $y=r$ ,显然若想到达指定点，就必须经过这一条直线，若路径最后一次经过该直线上的点 $(j,r)(0\leqslant j\leqslant n-r)$ ，那么从出发点到这个点共有 $\binom{j+r}{r}$ 种可能路径，而在经过这个点之后，我们不能再立即向右走（否则就不是最后一个交点了），我们只能向上走达到高度 $r+1$ ，那么之后的路就无法继续向上走，而只能一路向右到达指定点。（要注意的是，这里的点 $(j,r)(0\leqslant j\leqslant n-r)$ 是指路径最后一个与直线 $y=r$ 相交的点，因为我们其实完全可以沿着这条直线走一段距离，在那种情况下路径会与这条直线有许多个交点。）

&emsp;&emsp; **问题二：** 设指定点为 $(a,b)(a<b)$ ,有多少条路径不会触碰到直线 $y=x$ ?

&emsp;&emsp; 显然，第一步必须向上走（否则就会来到直线 $y=x$ 下方导致必然触碰到该直线，毕竟指定点在这条直线上方）。

&emsp;&emsp; 这样，问题转化为了从点 $(0,1)$ 走到指定点，不考虑限制条件，一共走了 $a+b-1$ 步，其中有 $a$ 步是向右走，故有 $\binom{a+b-1}{a}$ 种可能路径。

&emsp;&emsp; 我们把可能的路径分为两类，一类是不触碰到直线 $y=x$ ，记为集合 $S_1$ ,另一类是触碰到直线 $y=x$ ，记为集合 $S_2$ 。但是要注意的是，这两类可能的路径都是从点 $(0,1)$ 走到指定点，而并不是从点 $(0,0)$ 出发的。我们要求的就是集合 $S_1$ 的势（也就是元素个数）。

&emsp;&emsp; 我们考虑一类特殊的路径，从点 $(1,0)$ 走到指定点，显然，这类路径必然会与直线 $y=x$ 相交，记为集合 $S_3$ 。我们接下来证明集合 $S_2$ 与集合 $S_3$ 之间存在一个双射：

&emsp;&emsp; 考虑集合 $S_2$ 中的任意一条路径P，该路径与直线 $y=x$ 相交于点 $(m,m)$ ,我们将从点 $(0,1)$ 走到点 $(m,m)$ 的这段路径沿直线 $y=x$ 对称，恰好能得到一条从点 $(1,0)$ 到指定点 $(a,b)$ 的路径，显然这条路径属于集合 $S_3$ ,当我们考虑集合 $S_3$ 中的任意一条路径F时，也依据相同的原理来做对称，不难看出这其实就是一个从集合 $S_2$ 到集合 $S_3$ 的双射，即两集合具有相同的元素个数。

$$\begin{align\*}
|S_2|=|S_3|=\binom{a+b-1}{a-1}\\
\therefore |S_1|=\binom{a+b-1}{a}-|S_2|=\binom{a+b-1}{a}-\binom{a+b-1}{a-1}\\
=\frac{(a+b-1)!}{a!(b-1)!}-\frac{(a+b-1)!}{(a-1)!b!}=\frac{b}{a+b}\frac{(a+b)!}{a!b!}-\frac{a}{a+b}\frac{(a+b)!}{a!b!}\\
|S_1|=\frac{b-a}{a+b}\frac{(a+b)!}{a!b!}=\frac{b-a}{a+b}\binom{a+b}{a}
\end{align\*}$$

<p align="center">
<img src="https://github.com/user-attachments/assets/41f795ff-e151-4d84-93d7-b5406c5d9db3" width="250" />

&emsp;&emsp; **问题三：** 设指定点 $(a,b)(a\leqslant b)$ ,有多少条可能的路径不穿过直线 $y=x$ ?(意思是可以触碰，但不能越过)

&emsp;&emsp; 我们把所有可能的路径都向上平移一格，不难发现，这样原先所有符合要求的路径都不与直线 $y=x$ 相交（连触碰都不会发生），这样原先的那些路径变为了从点 $(0,0)$ 到点 $(a,b+1)$ 并且并不触碰直线 $y=x$ ，这样我们就可以直接使用问题二的结论，得到数目为：

$$\begin{align\*}
\frac{b-a+1}{a+b+1}\binom{a+b+1}{a}
\end{align\*}$$

&emsp;&emsp; 特别地，当 $a=b$ 时，就有

$$\begin{align\*}
\frac{1}{2a+1}\binom{2a+1}{a}=\frac{1}{2a+1}\frac{(2a+1)!}{a!(a+1)!}=\frac{1}{a+1}\frac{2a!}{a!a!}=\frac{1}{a+1}\binom{2a}{a}
\end{align\*}$$

>  $\frac{1}{a+1}\binom{2a}{a}$ 也被称为卡特兰数，是一个非常重要的组合数

## 可重复的排列与组合
### 可重复的排列

&emsp;&emsp; 所谓有重复，就是从集合中取走一个元素并记录后再把这个元素放回集合，下一次取时依然可以取这个元素。这与我们之前讨论的情况并不相同，之前我们从n个元素中选取r个元素，第一次有n种选择，第二次有n-1种选择，以此类推，但是对于有重复的排列，第一次有n种选择，第二次取时第一次取出的元素已经放回了，所以第二次还仍有n种选择，以此类推，每一次都会有n种选择。

&emsp;&emsp; 显然，根据乘法原理，n个元素的集合允许重复的r排列个数是 $n^r$ 。

### 有重复的组合

&emsp;&emsp; 有重复的组合解释起来有些困难。比如说我现在有三种水果，分别是橘子，苹果和梨，现在要求是选择5个水果，比如说我拿三个橘子一个苹果和一个梨，或者干脆拿五个苹果了事。

&emsp;&emsp; 再抽象一点，我的集合中有n个元素，每个元素都代表一种类别，每个类别都有足够充足的数量，现在让你从这n个类别中一共取出r个，你可以从这个类别中拿几个，再从另外一个类别中拿几个，拿到r个为止就是了。不难理解，我从同一类别中拿出的元素肯定是相同的（或者说是重复的），这就是有重复的组合。

&emsp;&emsp; 我们使用**隔板法**来解决这个问题。

&emsp;&emsp; 假设n个类别分别放在n个相邻的格子里，格子与格子之间有隔板阻挡着，我们现在要把r个物体放在这n个格子里，放在哪个格子里，放了多少，就意味着从这个格子里拿出多少物体。

&emsp;&emsp; 等等，这依然没有办法来算...但是如果我们用“*”来表示放入格子中的物体，用“|”来表示相邻格子之间的隔板，那画风就会变成下面的样子：

$$\begin{align\*}
*\*\*|||\*\*||\*\*||...||\*\*|\\
\end{align\*}$$

&emsp;&emsp; 隔板都放好了，那格子里有什么元素也就确定了，第一个隔板之前的就在第一个格子里，第一个隔板到第二个隔板之间的就在第二个格子里，以此类推，如果两个隔板之间什么都没有，就意味着两个隔板之间的格子里啥也没放。这样一切就都确定了。

&emsp;&emsp; 看着上面的那一大长串，你是否意识到，所谓的这一大串，其实就是r个“*”，n-1个“|”，一共r+n-1个符号。那这不就是在r+n-1个位置里找到r个位置来放“\*”吗?!

&emsp;&emsp; 我们这样就得到了n元素集允许重复的r组合的个数： $C(n+r-1,r)$ ,当然这也等于 $C(n+r-1,n-1)$ 。

&emsp;&emsp; 但是，隔板法的应用远远超出我们的想像，不妨我们来单独讨论一下这一点。

### 隔板法的应用

**1.不定方程的非负整数解**

&emsp;&emsp; 现有如下方程：

$$\begin{align\*}
x_1+x_2+...+x_n=r(r\in N)
\end{align\*}$$

&emsp;&emsp; 目标是求出该方程非负整数解的个数。

&emsp;&emsp; 我们考虑r个小球，n-1个隔板，把隔板随便放，就得到了把r个小球放在n个格子里的方法，一个格子里最多有r个小球，最小有0个，那这不就是非负整数解吗？所以我们就得到了求上述方程非负整数解个数的方法：其实就是隔板法。个数为 $\binom{n+r-1}{r}$ 。

&emsp;&emsp; **变式1：** 如果要求上述方程正整数解的个数呢？

&emsp;&emsp; 若 $x_i\geqslant1(1\leqslant i\leqslant n)$ ，那么 $x_i-1\geqslant0(1\leqslant i\leqslant n)$ ，所以我们换元处理，令   $y_i=x_i-1(1\leqslant i\leqslant n)$ ，一旦 $y_i$ 确定， $x_i$ 就可以被确定，这样原方程就变成了下面的方程：

$$\begin{align\*}
y_1+y_2+...+y_n=r-n
\end{align\*}$$

&emsp;&emsp; 利用原模型得到的结论，就可以得出解的个数为 $\binom{r-1}{r-n}$ 。

&emsp;&emsp;  **变式2：** 如果每个元素都有下限呢？

&emsp;&emsp; 若 $x_i\geqslant a_i(1\leqslant i\leqslant n)$ ，那么 $x_i-a_i\geqslant0(1\leqslant i\leqslant n)$ ，所以我们换元处理，令   $y_i=x_i-a_i(1\leqslant i\leqslant n)$ ，一旦 $y_i$ 确定， $x_i$ 就可以被确定。需要额外注意的是，此处的 $a_i$ 只要求是整数，而不要求是正整数，很容易理解。此时解的个数为：

$$\begin{align\*}
\binom{n+r-1-\sum_{i=1}^na_i}{n-1}
\end{align\*}$$

**变式3：** 如果每个元素都有上限呢？

&emsp;&emsp; 若 $x_i\leqslant a_i(1\leqslant i\leqslant n)$ ，那么 $a_i-x_i\geqslant0(1\leqslant i\leqslant n)$ ，所以我们换元处理，令   $y_i=a_i-x_i(1\leqslant i\leqslant n)$ ，一旦 $y_i$ 确定， $x_i$ 就可以被确定。原方程即可变为：

$$\begin{align\*}
y_1+y_2+...+y_n=\sum_{i=1}^na_i-r
\end{align\*}$$

&emsp;&emsp; 可得解的个数为

$$\begin{align\*}
\binom{n+\sum_{i=1}^na_i-r-1}{n-1}
\end{align\*}$$


&emsp;&emsp; **变式4：** 如果这不是一个等式呢？

&emsp;&emsp; 求满足下列不等式的非负整数解的个数：

$$\begin{align\*}
x_1+x_2+...+x_n\leqslant r
\end{align\*}$$

&emsp;&emsp; 当然，我们可以使用 $x_1+x_2+...+x_n= i(0\leqslant i\leqslant r)$ 的累加，但是，我们还可以做如下的操作：

$$\begin{align\*}
令x_{n+1}=r-x_1+x_2+...+x_n\geqslant 0\\
\therefore x_1+x_2+...+x_n+x_{n+1}=r\\
即求下面这个方程的非负整数解的个数
\end{align\*}$$

&emsp;&emsp; 仍然套用原模型的结论，可以得 $\binom{n+r}{r}$ 。

&emsp;&emsp; **2.一道例题**

&emsp;&emsp; 从 $\{1,2,...,n\}$ 中选取r个互不相邻的整数，有多少种取法？

&emsp;&emsp; 分析：先不管三七二十一，先把r个整数选出来，再将其调整为互不相邻即可。

&emsp;&emsp; 显然，我们有 $x_1\geqslant1$ , $x_2-x_1\geqslant 2$ , $x_3-x_2\geqslant 2$ ,..., $x_r-x_{r-1}\geqslant 2$ , $x_r\leqslant n$ 。我们令 $y_1=x_1-1$ , $y_2=x_2-x_1-2$ ,..., $y_r=x_r-x_{r-1}-2$ , $y_{r+1}=n-x_r$ 。我们会有：

$$\begin{align\*}
y_1,y_2,...,y_{r+1}都是非负整数，并且:\\
y_1+y_2+...+y_{r+1}=n-1-2(r-1)=n-2r+1\\
即求下面这个方程的非负整数解的个数
\end{align\*}$$

&emsp;&emsp; 所以答案为 $\binom{n-r+1}{r}$ 。

&emsp;&emsp; 似乎到这里，我们已经把大部分问题讨论的差不多了，但是真的是这样的吗？假设我们现在有三个苹果两个梨和五个橘子，请问这些物体有多少种可能的排列顺序？

&emsp;&emsp; 我们发现，单纯依靠原有的模型，我们无法得出求解这个问题的公式，所以，我们的路依然没有走完，还有下面的这些：

## 带有不可区别的物体的排列

&emsp;&emsp; 我们最开始的排列，默认每个元素都是不同的，因为一旦两个元素是相同的，我们把这两个元素调换位置，就把两种方法数合并成了一种。后来我们讲有重复的排列，每一类元素也都是不同的，只是每一类元素都可以重复地挑选而已。而现在的带有不可区别的物体的排列，就大不一样了，可供挑选的范围内出现了相同的物体，挑哪个都一样。

&emsp;&emsp; 比如说你现在有两个苹果一个梨，苹果1-梨-苹果2与苹果2-梨-苹果1是相同的排列，因为苹果1与苹果2都是苹果，没什么差别(序号1,2只是为了便于阐述，并不影响两个苹果相同)。那么，我们就有下面的抽象：

$$\begin{align\*}
一共有n个物体，其中分别有n_i个物体是相同的(1\leqslant i\leqslant k)，那么这n个物体所有可能的排列数为：\\
\frac{n!}{n_1!n_2!...n_k!}(前提是\sum_{i=1}^kn_i=n)
\end{align\*}$$

&emsp;&emsp; 为什么会这样呢？在 $n!$ 种方法数中，一旦有 $n_i$ 个元素是相同的，就可以把 $n_i!$ 种方法数合并成一种，就出现了上面的式子。或者换一种思路：因为相同的元素可以调换位置而不影响排列，所以我们考虑 $n$ 个位置，第一次安放相同的 $n_1$ 个元素，第二次安放相同的 $𝑛_2$ 个元素，第 $i$ 次安放相同的 $n_i$ 个元素，我们就有下面的关系：

$$\begin{align\*}
\binom{n}{n_1}\binom{n-n_1}{n_2}\binom{n-n_1-n_2}{n_3}\cdot\cdot\cdot\binom{n-n_1-n_2-...-n_{k-1}}{n_k}\\
=\frac{n!}{n_1!n_2!...n_k!}
\end{align\*}$$

&emsp;&emsp; 延伸：已知多项式定理如下：

$$\begin{align\*}
(x_1+x_2+...+x_t)^n=\sum_{n_i\geqslant0,n_1+n_2+...+n_t=n}\frac{n!}{n_1!n_2!...n_t!}x_1^{n_1}x_2^{n_2}\cdot\cdot\cdot x_t^{n_t}
\end{align\*}$$

- 我们通常使用记号 $\binom{n}{n_1\;n_2 ...\;n_t}$ 来表示 $\frac{n!}{n_1!n_2!...n_t!}$ ，这也被称为多项式系数。

  

&emsp;&emsp; 对于多项式系数，我们也有帕斯卡恒等式，如下：

$$\begin{align\*}
\binom{n}{n_1\;n_2 ...\;n_t}=\binom{n-1}{n_1-1\;n_2 ...\;n_t}+\binom{n-1}{n_1\;n_2-1 ...\;n_t}+...+\binom{n-1}{n_1\;n_2 ...\;n_t-1}
\end{align\*}$$

## 带有不可区别的物体的组合

&emsp;&emsp; 既然有不可区别的物体的排列，那必然会有不可区别的物体的组合了。但是这种情况下并没有很好的计数方法，而需要一些其他的方法来做，在这里暂时不议。

## 把物体放入盒子

&emsp;&emsp; 把物体放入盒子，这听上去非常朴实无华而又人畜无害对吧？实际上并不是这样的。物体是否相同？盒子是否相同？这些都是我们需要考虑的因素，也就是说，足足有四种情况需要一一讨论。

&emsp;&emsp; 另外，课本上非常明确地使用了两个词语：“可辨别的”和“不可辨别的”，在这里我就不写这么麻烦了，干脆分别写成“相同的”或者是“不同的”。

### 不同的物体+不同的盒子

&emsp;&emsp; 把n个物体放到k个盒子里：

- 如无特殊要求，那就是 $k^n$ 种方法，因为每个物体都有 $k$ 个选择。
- 若要求第 $i$ 个盒子里放入 $n_i$ 个元素， $\sum_{i=1}^kn_i=n$ ，那么其实就是 $\frac{n!}{n_1!n_2!...n_k!}$ ，原理与该式的推导过程相似。

### 相同的物体+不同的盒子

&emsp;&emsp; 这个标题有没有一些似曾相识的感觉？

&emsp;&emsp; 把物体用隔板隔开再放到对应的格子里，这不就是隔板法吗？ $n$ 个物体， $k$ 个盒子，那么就有 $k-1$ 个隔板，故方法数为 $\binom{n+k-1}{k-1}$ 。

### 不同的物体，相同的盒子

&emsp;&emsp; 这个该如何理解呢？举个例子，我们有四名员工，分别是A，B，C，D，我们要给这四名员工分配办公室，每个办公室最少没人，最多四人，有四间办公室，问有多少种分配方法？

&emsp;&emsp; 四间办公室，我们可以只使用一间，就是把四人全挤在一间办公室里，也可以只使用两间，一间放3人一间放1人，或者每间都放2人，还可以只使用三间，分别放一人一人两人，或者四间全用，每间放一人。

&emsp;&emsp; 但是，如果我们真的要算，这么分类下去估计会累死，我们考虑下面一种抽象：

&emsp;&emsp; 把 $n$ 个不同的物体放入 $k$ 个相同的盒子，令 $S(n,m)$ 为把n个物体放入m个相同盒子并且这每个盒子都至少有一个元素，那么显然(结合所举例子仔细体会):

$$\begin{align\*}
方法数=\sum_{m=1}^kS(n,m)
\end{align\*}$$

&emsp;&emsp; 我们这里暂时先不写 $S(n,m)$ 该如何推导(需要等到第八章)，我们直接给出结论:

$$\begin{align\*}
S(n,m)=\frac{1}{m!}\sum_{i=0}^{m-1}(-1)^i\binom{m}{i}(m-i)^n
\end{align\*}$$

> 这也被叫做第二类斯特林数

&emsp;&emsp; 这里的 $S(n,m)$ 有如下性质：

-  $S(0,0)=1$ ,对于 $k>0,  S(0,k)=0$ 
-  对于 $n>0, S(n,0)=0$ 
-  如果 $n=m, S(n,m)=1$ , 如果 $n<m, S(n,m)=0$ 
-  $S(n,m)=mS(n-1,m)+S(n-1,m-1)$

> 值得注意的是， $S(0,0)=1$ 是人为规定。另外，最后一个递推式也颇有意思，n个物体放入m个盒子，要么n-1个物体已经让m个盒子都非空了，此时只需要从m个盒子中选一个即可，要么n-1个物体只占据了m-1个盒子，那第n个物体必须再占据一个新盒子来保证总共有m个盒子非空。

### 相同的物体，相同的盒子

&emsp;&emsp; 把 $n$ 个相同的物体放入到 $k$ 个相同的盒子中。针对这类问题，我们现在依然无法得到一个很有效的解。我们只能做如下的探索：

&emsp;&emsp; 我们令 $p(n,m)$ 为将正整数n分解为m个正整数之和的方法数，那么上述问题就可以转化为求下列式子：

$$\begin{align\*}
\sum_{m=1}^np(n,m)
\end{align\*}$$

&emsp;&emsp; 实际上，把 $n$ 个相同的物体放入到 $k$ 个相同的盒子中这个问题，我们就称之为整数拆分问题。

&emsp;&emsp; 另外， $p(n,m)$ 还可以这样描述：把正整数 $n$ 拆分为若干个正整数的加和，这若干个正整数皆小于等于 $m$ 。

&emsp;&emsp; 为什么会有这样的两种描述呢？

&emsp;&emsp; 我们引入一种全新的结构，叫做费里尔图，这种图是如下被绘制的：

&emsp;&emsp; 比如说14可以拆分为5+3+3+2+1，那么该图的第一行有5个点，第二行有3个点，以此类推，我们就得到了下面的图：
<p align="center">
<img src="https://github.com/user-attachments/assets/a4204d4b-f64f-4242-9afa-2df75515f130" width="150" />
 
&emsp;&emsp; 抽象一点，比如说 $n$ 可以被拆分为 $a_1+a_2+...+a_j$ ，并且 $a_1\geqslant a_2 \geqslant...\geqslant a_j$，那么我们就画一个第 $i$ 行有 $a_i$ 个点的图。

&emsp;&emsp; 那么我们如何利用这个图来说明 $p(n,k)$ 的两种描述呢？我们把这个图做一下“转置”(就像矩阵的转置那样)，我们就有了同一个数的两种不同拆法。(其实不转置也可以，也可以将费里尔图从左向右一列一列地读)，具体例子如下图所示：

<p align="center">
<img src="https://github.com/user-attachments/assets/8bb1dcbd-c9ba-415b-bab7-e24725044355" width="250" />


&emsp;&emsp; 其实这也不难理解，当把正整数n拆分为k个正整数的和时，就意味着画出的费里尔图有k行(这也就是第一列的行数)，而对该费里尔图进行转置之后，就意味着转置之后所代表的拆分方式拆出的最大正整数就是k。


