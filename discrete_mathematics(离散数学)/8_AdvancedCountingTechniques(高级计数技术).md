# 第八章 高级计数原理

## 递推关系的应用

&emsp;&emsp;我们都知道斐波那契数列，它具有下面的递推关系(为了省事，我们就不在研究那群不死的兔子了)：

$$\begin{align\*}
f_n=f_{n-1}+f_{n+2}(n\geqslant3),f_1=1,f_2=2
\end{align\*}$$

&emsp;&emsp;研究的重点以及难点就在于如何找到正确的递推关系，下面我们来举几个例子：

&emsp;&emsp;**例一：** 考虑 $n$ 位长的由0和1组成的二元字符串， $a_n$ 表示不含有连续两个0(或者说任何一个二长片段都不能是“00”)的 $n$ 长字符串的个数，试求出 $a_n$ 的递推关系。

> 求递推关系的关键在于考虑该项的前几项，而不是从第一项开始考虑。

&emsp;&emsp;**解：** 我们对 $n$ 长字符串做如下的分类：

&emsp;&emsp;1)该字符串以1开头，则剩余的 $n-1$ 位字符串不会出现两个连续的0，即有 $a_{n-1}$ 个。

&emsp;&emsp;2)该字符串以0开头，则第二位必然是1，并且剩余的 $n-2$ 位字符串里不会出现两个连续的0，即有 $a_{n-2}$  个。

&emsp;&emsp;所以我们获得了如下的递推关系：

$$\begin{align\*}
a_n=a_{n-1}+a_{n-2}
\end{align\*}$$

&emsp;&emsp;**例二：** 如果题目改成不含连续的三个0，递推关系又该是什么呢？

&emsp;&emsp;**解：** 我们对 $n$ 长字符串做如下的分类：

&emsp;&emsp;1)该字符串以1开头，则剩余的 $n-1$ 位字符串不会出现三个连续的0，即有 $a_{n-1}$ 个。

&emsp;&emsp;2)该字符串以0开头，那么又要分为两种情况，若第二位为0，那么第三位必然只能是1，而且剩余的 $n-3$ 位字符串不会出现连续的三个0，即有 $a_{n-2}$ 个；若第二位为1，那么第三位是0是1无所谓，只需要剩余的 $n-2$ 位字符串不会出现连续的三个0即可，即有 $a_{n-3}$ 个。

&emsp;&emsp;所以我们获得了如下的递推关系：

$$\begin{align\*}
a_n=a_{n-1}+a_{n-2}+a_{n-3}(n\geqslant4)
\end{align\*}$$

&emsp;&emsp;**例三：** 如果是不含连续的t个0呢？

&emsp;&emsp;同理可得：

$$\begin{align\*}
a_n=a_{n-1}+a_{n-2}+...+a_{n-t}(n\geqslant t+1)
\end{align\*}$$

&emsp;&emsp;**变式：** 如果要求该字符串同时不含连续的三个0和连续的三个1呢？

> 我们前几个例子给出的都是对第 $n$ 项进行分类，实际上我们也可以从第 $n-1$ 项或者第 $n-2$ 项开始，来将其转化为第 $n$ 项。

&emsp;&emsp;**解：** 我们考虑符合题意的 $n-1$ 长的字符串，如果我们在该字符串的开头添加0或1，它就变成了 $n$ 长的字符串，这样我们似乎是获得了 $2a_{n-1}$ 个符合题意的字符串，但是随即我们就发现，对于开头是00的 $n-1$ 长的字符串我们不能在开头加0，对于开头是11的 $n-1$ 长的字符串我们不能在开头加1，而开头是00的 $n-1$ 长的字符串剩余的 $n-3$ 位必然是以数字1开头的符合题意的字符串，而开头是11的 $n-1$ 长的字符串剩余的 $n-3$ 位必然是以数字0开头的符合题意的字符串，那么两种情况加起来既包含了数字1开头又包含了数字0开头，所以需要去掉的个数总共是 $a_{n-3}$ 个。所以我们有如下的递推：

$$\begin{align\*}
a_n=2a_{n-1}-a_{n-3}(n\geqslant4)
\end{align\*}$$

&emsp;&emsp;**另外一种方法：** 我们考虑这样一个双射，它把n长的二元字符串(对于双射的概念，详见第二章)

$$\begin{align\*}
x_1x_2...x_n(x_i=0或1，1\leqslant i\leqslant n)
\end{align\*}$$

&emsp;&emsp;转变为一个序对 $(x_1,\delta)$ ，其中：

$$\begin{align\*}
\delta=(x_1+x_2,x_2+x_3,...,x_{n-1}+x_{n})(mod\;2)\\
\end{align\*}$$

&emsp;&emsp;我们有原来的字符串，我们就能够计算出该序对，同样的，我们有了序对，就能恢复出原来的字符串，不难理解这是一个双射。

&emsp;&emsp;我们发现，如果有连续的三个0或者连续的三个1，那么 $\delta$ 中就会出现连续的两个0，所以我们只需要求出不含连续的两个0的 $\delta$  序列即可，对于原来是 $n$ 长的字符串，它会产生 $n-1$ 长的 $\delta$ 序列，我们令 $b_n$ 来表示 $n$ 长的不含连续两个0的 $\delta$ 序列，根据我们前面的例子，我们会有

$$\begin{align\*}
b_{n-1}=b_{n-2}+b_{n-3}(n\geqslant 4)
\end{align\*}$$

&emsp;&emsp;由于我们双射产生的序对是 $(x_1,\delta)$ ，那么对于任意一个合适的 $\delta$ 序列，我们的 $x_1$ 为0或者为1都可以产生符合题意的原字符串，也就是说，有

$$\begin{align\*}
a_n=2b_{n-1}
\end{align\*}$$

&emsp;&emsp;我们带回之前的递推，则有：

$$\begin{align\*}
a_n=a_{n-1}+a_{n-2}(n\geqslant 3)\\
\end{align\*}$$

&emsp;&emsp;**注意：** 有没有很惊讶，对于同一个数列，我们竟然能写出两种不同的递推关系，而且这两种递推关系都是正确的！那么实际上这是一件很容易发生的事情，我们有时候甚至能写出不止两种，但是尽管递推关系不同，最后求出的通项公式一定是相同的，这一点在后面我们还会提到。

### 卡特兰数的递推

&emsp;&emsp;还记得卡特兰数吗？我们在讲格点计数时提到过这一个重要的组合数。从 $(0,0)$ 走到 $(n,n)$ 允许触碰对角线但不允许越过对角线并且在对角线上方的路径的数目可以用卡特兰数 $C_n$ 来表示，其中：

$$\begin{align\*}
C_n=\frac{1}{n+1}\binom{2n}{n}
\end{align\*}$$

&emsp;&emsp;卡特兰数具有下面这样的递推：

$$\begin{align\*}
C_n=C_0C_{n-1}+C_1C_{n-2}+...+C_{n-2}C_1+C_{n-1}C_0
\end{align\*}$$

&emsp;&emsp;如何证明呢？依然是使用格点计数。

&emsp;&emsp;证明：我们记从 $(0,0)$ 走到 $(n,n)$ 第一次触碰对角线的位置为 $(k,k)$ ，其中 $1\leqslant k\leqslant n$ ，根据乘法计数原理，我们只需要将从 $(0,0)$ 走到 $(k,k)$ 的路径数乘以从 $(k,k)$ 走到 $(n,n)$ 的路径数即可。

&emsp;&emsp; $(k,k)$ 走到 $(n,n)$ 的路径数，因为 $(k,k)$ 是第一次触碰对角线的位置，所以在从 $(k,k)$ 走到 $(n,n)$ 的过程中我们依然可以触碰对角线，所以这同样也是一个卡特兰数，相当于从 $(0,0)$ 走到 $(n-k,n-k)$ ，故为 $C_{n-k}$ 。

&emsp;&emsp;我们再考虑从 $(0,0)$ 走到 $(k,k)$ 的路径数，因为 $(k,k)$ 是第一次触碰对角线的位置，所以在从 $(0,0)$ 走到 $(k,k)$ 的过程中我们不可以触碰对角线，所以不能直接使用卡特兰数。我们这样考虑：首先，从 $(0,0)$ 出发的第一步一定是向上走，否则就一定会走到对角线的下方，而到达 $(k,k)$ 的那一步一定是向右走而不能是向上走，否则也会到过对角线的下方，所以就相当于我们从 $(0,1)$ 出发，而来到了点 $(k-1,k)$ ，不难看出，从 $(0,1)$ 出发而到 $(k-1,k)$ 的过程中，是允许触碰到直线  $y=x+1$ 的，这就相当于是从 $(0,0)$ 出发而到 $(k-1,k-1)$ 并且允许触碰到对角线，那对应的路径数不就是卡特兰数 $C_{k-1}$ 吗？所以我们就有了第一次经过对角线是在点 $(k,k)$ 上的路径数：

$$\begin{align\*}
C_{k-1}C_{n-k}
\end{align\*}$$

&emsp;&emsp;这样，我们就获得了之前提到过的卡特兰数的递推关系。


&emsp;&emsp;之前我们提到过，许多组合问题的解其实就是卡特兰数，那么，在实际解题过程中，我们如何证明问题的解就是卡特兰数呢？

&emsp;&emsp;我们主要有两种方法。我们根据两个例题来详细解释。

&emsp;&emsp;**方法一：构造双射。** 将所求问题的任意一个解转化为格点计数中的一条路径(因为我们对于卡特兰数的推导就是使用格点计数来完成的)。

&emsp;&emsp;**例：** 我们现有一个由 $n$ 个0和 $n$ 个1组成的 $2n$ 长的序列，要求是从前往后数0的个数始终大于等于1的个数，求满足要求的序列的个数。

&emsp;&emsp;**解：** 我们考虑一个 $n\times n$ 的格表，从 $(0,0)$ 出发，每当序列中出现一个0就向上走一步，每当序列中出现一个1就向右走一步，要使序列中0的个数始终大于等于1的个数，那么走出的路径始终在对角线上方，并且顶多触碰对角线而不会穿过对角线，所以该问题的解就是卡特兰数。

&emsp;&emsp;**方法二：证明数列的初始项以及递推关系皆与卡特兰数的相同**

&emsp;&emsp;**例：** 我们现有n个矩阵相乘，记 $f_n$表示 $n+1$ 个矩阵相乘的顺序的总数，比如，对于 $f_3$ ，我们有如下五种相乘的顺序：

$$\begin{align\*}
(((A_0\times A_1)\times A_2)\times A_3)\\
(A_0\times(A_1\times(A_2\times A_3)))\\
((A_0\times(A_1\times A_2))\times A_3)\\
(A_0\times((A_1\times A_2)\times A_3))\\
((A_0\times A_1)\times(A_3\times A_4))\\
\end{align\*}$$

&emsp;&emsp;试求出 $f_n$ 。

&emsp;&emsp;我们首先研究初始项，显然 $f_0=1$ , $f_1=1$ 。

&emsp;&emsp;之后我们研究 $f_n$ ，我们考虑 $n$ 个 $\times$ 中最后一个被运算的乘号，比如举例中第一行中的第三个乘号，第二行中的第一个乘号等等，不妨令这个 $\times$ 为第 $k$ 个 $\times$ ，则前面有 $k+1$ 个矩阵，有 $f_k$ 种运算顺序，后面有 $n-k$ 个矩阵，有 $f_{n-k-1}$ 种运算顺序，所以当最后一个被运算的乘号为第 $k$ 个乘号时，有 $f_kf_{n-k-1}$ 种运算顺序，当 $k$ 从0取到 $n-1$ 时，我们就获得了如下的递推：

$$\begin{align\*}
f_n=f_0f_{n-1}+f_1f_{n-2}+...+f_{n-1}f_0
\end{align\*}$$

&emsp;&emsp;显然， $f_n$ 不仅满足初始项与卡特兰数的初始项相同，就连递推关系也与卡特兰数的相同，故该问题的解就是卡特兰数。

## 求解线性递推

&emsp;&emsp;我们单纯地只知道线性递推公式是没有什么用，我们需要知道数列的通项公式，所以我们接下来就要学习如何通过递推关系来获得通项公式。

&emsp;&emsp;首先，我们需要了解**常系数k阶线性齐次递推**，其形式如下：

$$\begin{align\*}
a_n=c_1a_{n-1}+c_2a_{n-2}+...+c_ka_{n-k}
\end{align\*}$$

&emsp;&emsp;其中 $c_1,c_2,...,c_k$ 都是实数并且 $c_k\neq 0$ 。

- 所谓常系数，是指 $c_1,c_2,...,c_k$ 都是实数并且与 $n$ 无关。
- 所谓 $k$ 阶，是指这个递推关系一直要从第 $n$ 项涉及到第 $n-k$ 项。
- 所谓线性，是因为式中只出现数列中的项的一次方，而无其他次方。
- 所谓齐次，是指式中并无与数列中的项不相关的常数(等到看非齐次的时候就明白了)

&emsp;&emsp;首先，该递推关系应有形如 $r^n$ 的解，那么则有

$$\begin{align\*}
r^n=c_1r^{n-1}+c_2r^{n-2}+...+c_kr^{n-k}\\
\end{align\*}$$

&emsp;&emsp;方程两边同时除以 $r^{n-k}$ ，可得到一个方程，该方程也被称为特征方程：

$$\begin{align\*}
r^k=c_1r^{k-1}+c_2r^{k-2}+...+c_k\\
\end{align\*}$$

&emsp;&emsp;该方程的解被称为该递推关系的特征根。显然地，我们可以通过特征根来构造出数列的通项公式。

&emsp;&emsp;我们先来考虑二阶的情形：

&emsp;&emsp; $c_1,c_2$ 是实数，假设方程 $r^2-c_1r-c_2=0$ 有两个不同的根 $r_1$ 和 $r_2$ 。那么 $\\{a_n\\}$ 是递推关系 $a_n=c_1a_{n-1}+c_2a_{n-2}$ 的解当且仅当 $a_n=\alpha_1r_1^n+\alpha_2r_2^n$ ，其中 $\alpha_1,\alpha_2$ 是常数。

**证明：**

&emsp;&emsp;如果 $a_n=\alpha_1r_1^n+\alpha_2r_2^n$ ，那么

$$\begin{align\*}
a_n=\alpha_1r_1^n+\alpha_2r_2^n=\alpha_1r_1^{n-2}(c_1r_1+c_2)+\alpha_2r_2^{n-2}(c_1r_2+c_2)\\
=c_1(\alpha_1r_1^{n-1}+\alpha_2r_2^{n-1})+c_2(\alpha_1r_1^{n-2}+\alpha_2r_2^{n-2})\\
=c_1a_{n-1}+c_2a_{n-2}\\
\end{align\*}$$

&emsp;&emsp;这样就能够说明 $\{a_n\}$ 是该递推关系的解。
&emsp;&emsp;如果 $\\{a_n\\}$ 是该递推关系的解，我们令 

$$\begin{align\*}
a_0=\alpha_1+\alpha_2\\
a_1=\alpha_1r_1+\alpha_2r_2\\
\end{align\*}$$

&emsp;&emsp;我们解得

$$\begin{align\*}
\alpha_1=\frac{a_1-a_0r_2}{r_1-r_2},\alpha_2=\frac{a_0r_1-a_1}{r_1-r_2}
\end{align\*}$$

&emsp;&emsp;而我们已知 $\\{\alpha_1r_1^n+\alpha_2r_2^n\\}$ 满足递推关系并且该序列与原序列的初始项相同(这就是我们构造 $\alpha_1,\alpha_2$ 的意义所在)，所以 $\{\alpha_1r_1^n+\alpha_2r_2^n\}$ 是原序列的一个解，由于**具有两个初始条件的2阶常系数线性齐次递推只有唯一解**，所以 $\\{a_n\\}$ = $\\{\alpha_1r_1^n+\alpha_2r_2^n\\}$ 。

> 这里我们来解释为什么具有两个初始条件的2阶常系数线性齐次递推只有唯一解，不难看出，当 $a_1,a_2$ 已知时，根据递推关系就能够求出 $a_3$ ，之后求出 $a_4,a_5...$ ，也就确定了一整个序列，故只可能有唯一解。

> 另外值得注意的是，当我们在利用条件 $a_n=\alpha_1r_1^n+\alpha_2r_2^n$ 来推导另一边时，我们并没有使用到初始值，因为另一边的结论只要求 $\{a_n\}$ 是该递推关系的一个解，并没有要求 $\{a_n\}$ 是原序列。而当我们利用 $\{a_n\}$ 是递推关系 $a_n=c_1a_{n-1}+c_2a_{n-2}$ 的解这一条件时，我们则是假定了一个原序列来使用唯一解的结论。
